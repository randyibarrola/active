
$(document).ready(function() {
    
    cardValidation();
    terminarReservacion();
    
    $('input[name=email]').change(function(){
        $('#enviaremos-a-email').html($(this).val());
    });
    $('#enviaremos-a-email').html($('input[name=email]').val());
    //console.log($('#frmDatos').height(), top);
    top.iframeHeight($('#frmDatos').height() + 150);
    
    //top.hideFrameBlocker();
    //toastr.success('hola');
    
    $('#book_conditions, #privacy_policies').off('click').on('click', function(e){
        e.preventDefault();
        var id = $(this).attr('id');
        top.showModalPopup(id);
    });
    
    if(error_msg) toastr.error(error_msg);
    
    if($('#captchadiv').length > 0)
        showRecaptcha();
    
    
});

function moneyConverter(cant) {
    var c = parseFloat(cant).toFixed(2);
    c = CURRENCY + " " + ("" + c).replace(".", ",");
    return c;
}


function cardValidation() {
    
    var cards = new Array();
    $('ul.cards li').each(function(){
        
        cards.push($(this).attr('card'));
    });
    
    if($('input[name=tarjetaNumero]').length > 0) {
        $('input[name=tarjetaNumero]').attr('valid-card', false);
        $('input[name=tarjetaNumero]').validateCreditCard(function(ev){
                $(".cards li").addClass("off");
                $('input[name=tarjetaNumero]').removeClass('validCreditCard');
                if(ev.card_type==null){
                        $('input[name=tarjetaNumero]').attr('valid-card', false);
                        $('input[name=tarjetaTipo]').val('');
                        return
                }
                $(".cards ." + ev.card_type.name).removeClass("off");
                $('input[name=tarjetaTipo]').val($(".cards ." + ev.card_type.name).attr('title'));
                if(ev.length_valid && ev.luhn_valid) {                
                     $('input[name=tarjetaNumero]').attr('valid-card', true).addClass('validCreditCard');
                     
                     return true;
                }
                return false;
        },
        {accept:cards}
        );
    }
    
}

function terminarReservacion() {
    $('#frmDatos').off('submit').submit(function(e){
        //e.preventDefault();
        valid = $(this).validationEngine('validate');
        if(valid){            
            top.showFrameBlocker();
            /*
            data = $(this).serialize() + "&action=insert";
            $.ajax({
                url: BASE_URL + '/ajax-reserva',
                data: data,
                type: 'post',
                dataType: 'json',
                success: function(response) {
                    $('#blocker').fadeOut();
                    if(response.msg == 'ok') {
                        //toastr.success(response.data);
                        //setTimeout(function(){
                            window.location = BASE_URL + '/confirmacion/id:' + $('input[name=idApartamento]').val() + '/r_id:' + response.reserva_id;
                        //}, 3500);
                    } else {
                        toastr.error(response.data);
                    }
                }
            });
            */
            return true;
        } else {
            e.preventDefault();
            return false;
        }
        
    })
}

function showRecaptcha() {
    Recaptcha.create("6LcY-uYSAAAAACBIaBBmfEdbYqJxCkDdtOONaeIE", 'captchadiv', {
        tabindex: 1,
        theme: "clean",
        callback: Recaptcha.focus_response_field
    });
}

